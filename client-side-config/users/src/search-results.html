<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>

    <link rel="stylesheet" href="main.css" />
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="../assets/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="../assets//boxicons/css/boxicons.min.css" rel="stylesheet" />
    <!-- Icon Font Stylesheet -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Include jQuery UI -->
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../frontend.js"></script>
    <script src="../script.js"></script>


    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Flowbite CSS CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <!-- Flowbite JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>

    <style>
/* CSS styles */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #EEECF0; /* Background color */
}

.sticky-top {
    position: sticky;
    top: 0;
    z-index: 1;

}

.text-smaller {
    font-size: 0.8rem;
}

.text-sm {
    font-size: 14px;
  }

.text-xs {
    font-size: 12px;
}

.no-border {
    border: none;
}

.rounded-xs {
    border-radius: 4px;
}

#sidebar {
    float: left;
    width: 20%;
    background-color: #F9F9F9;
    padding: 20px;
    height: 100vh; /* Set height to full viewport height */
    box-sizing: border-box; /* Ensure padding is included in the height */
    position: fixed; /* Keep the sidebar fixed while scrolling */
    top: 102px; /* Position below the header */
    left: 0; /* Position at the left of the viewport */
    overflow-y: auto; /* Enable vertical scrolling if content exceeds height */
}


#sidebar h2 {
    margin-bottom: 10px;
    color: #000; /* Set text color to black */
    font-size: 1.2em; /* Increase font size for headings */
}

#sidebar ul {
    list-style-type: none;
    padding: 0;
    margin: 0; /* Remove default margin */
}

#sidebar li {
    margin-bottom: 10px;
}

/* New UI styles */
.active-filter {
    background-color: #3A5283; /* Change background color for active filters */
    color: #FFFFFF; /* Set text color to white for active filters */
}

#sidebar button {
    background-color: transparent;
    color: #3A5283;
    border: none;
    padding: 12px 20px;
    font-size: 1em; /* Set font size to default */
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%; /* Expand button to full width */
    display: block; /* Ensure button occupies its own line */
}

#sidebar button:hover {
    background-color: #AEDEFC; /* Change background color on hover */
}


#Results {
    margin-left: 20%;
    padding: 20px;
    width: 70vh;
}

.result {
    border: 1px solid #ccc;
    margin-bottom: 10px;
    padding: 10px;
    position: relative;
    border-radius: 0 1.3rem 1.3rem 1.3rem; /* top-left, bottom-left, bottom-right, top-right */
}

.hidden {
    display: none;
}


.user-link,
.post-link {
    color: #3A5283;
    text-decoration: none;
    vertical-align: middle;
}

.user-link:hover,
.post-link:hover {
    text-decoration: underline;
}

.follow-button {
    background-color: #3A5283;
    color: #FFFFFF;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    right: 10px;
    margin-right: 10px;
}

.follow-button:hover {
    background-color: #FCA303;
}

.see-more-button {
    display: block;
    margin-top: 10px;
    background-color: #3A5283;
    color: #FFFFFF;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.see-more-button:hover {
    background-color: #FCA303;
}

.profile-picture {
    width: 3.5rem; /* Equivalent to w-10 */
    height: 3.5rem; /* Equivalent to h-10 */
    padding: 0.25rem; /* Equivalent to p-1 */
    border-radius: 50%; /* Equivalent to rounded-full */
    object-fit: cover; /* Ensures the image covers the entire container */
    margin-right: 0.5rem; /* Adjust as needed */
    margin-top: 0.5rem; /* Adjust as needed */
    border: 2px solid #6B7280; /* Equivalent to ring-2 and ring-gray-300 */
}

.dark .profile-picture {
    border-color: #6B7280; /* Equivalent to dark:ring-gray-500 */
}

.user-container {
    margin-bottom: 20px; /* Add margin between user containers */
    display: flex;
    flex-wrap: wrap; /* Allow flex items to wrap to the next line */
}

.user-element {
    display: flex;
    flex-direction: column; /* Display children vertically */
    margin-bottom: 10px; /* Add margin between user elements */
}

.user-info {
    margin-top: 10px;
    margin-left: 5px;
    flex: 1;
}

.user-name {
    font-weight: bold;
}

.bio {
    font-size: 14px;
    color: #666;
    overflow: hidden;
    white-space: nowrap;
    width: 100%; /* Adjusted width for bio */
    margin-top: 5px; /* Adjust spacing between name and bio */
    padding: 5px;
    text-overflow: ellipsis;
}

.view-profile-button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 24px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
}

.view-profile-button:hover {
    background-color: #45a049;
}

@media screen and (max-width: 768px) {
    .user-element {
        align-items: center; /* Center align elements */
        text-align: center; /* Center align text */
        overflow-y: hidden;
    }
}
    </style>
</head>
<body>
      <!-- Navigation bar -->
      <header
        id="header"
        class="header d-flex align-items-center justify-content-between mb-3 sticky-top"
      >
        <div class="d-flex">
          <i
            class="bi bi-list d-block d-md-none"
            style="font-size: 24px; margin-right: 16px"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasRight"
            aria-controls="offcanvasRight"
          ></i>
          <a href="home.html" class="logo d-flex align-items-center">
            <img src="../img/logo2.png" alt="logo" style="height: 32px" />
          </a>
        </div>

        <nav class="header-nav">
          <ul class="d-flex align-items-center gap-2">
            <li class="nav-item d-block d-lg-none"></li>
            <!-- End Search Icon-->

            <div
              class="border rounded-xs overflow-hidden d-flex align-items-center"
              style="width: 250px"
            >
              <img src="../img/search.svg" height="16px" alt="" class="px-2" />
              <input
                type="text"
                class="no-border py-1 text-sm"
                placeholder="Search here"
                style="height: 32px; outline: none"
              />
            </div>

            <li class="nav-item dropdown">
              <button id="dropdownNotificationButton" data-dropdown-toggle="dropdownNotification" class="relative inline-flex items-center text-sm font-medium text-center text-gray-500 hover:text-gray-900 focus:outline-none dark:hover:text-white dark:text-gray-400" type="button">
                  <img src="../img/notif.svg" height="16px" alt="" />
                  <!-- Optionally, you can add a badge for new notifications -->
                  <!-- <span class="badge rounded-pill bg-primary p-2 ms-2">4</span> -->
              </button>
              <div id="dropdownNotification" class="z-20 hidden w-full max-w-sm bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-800 dark:divide-gray-700" aria-labelledby="dropdownNotificationButton">
                  <div class="block px-4 py-2 font-medium text-center text-gray-700 rounded-t-lg bg-gray-50 dark:bg-gray-800 dark:text-white">
                      Notifications
                  </div>
                  <div class="divide-y divide-gray-100 dark:divide-gray-700">
                      <!-- Replace this section with your actual notifications -->
                      <!-- Example Notification -->
                      <a href="#" class="flex px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700">
                          <div class="flex-shrink-0">
                              <img class="rounded-full w-11 h-11" src="/docs/images/people/profile-picture-1.jpg" alt="Jese image">
                              <div class="absolute flex items-center justify-center w-5 h-5 ms-6 -mt-5 bg-blue-600 border border-white rounded-full dark:border-gray-800">
                                  <svg class="w-2 h-2 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 18">
                                      <path d="M1 18h16a1 1 0 0 0 1-1v-6h-4.439a.99.99 0 0 0-.908.6 3.978 3.978 0 0 1-7.306 0 .99.99 0 0 0-.908-.6H0v6a1 1 0 0 0 1 1Z"/>
                                      <path d="M4.439 9a2.99 2.99 0 0 1 2.742 1.8 1.977 1.977 0 0 0 3.638 0A2.99 2.99 0 0 1 13.561 9H17.8L15.977.783A1 1 0 0 0 15 0H3a1 1 0 0 0-.977.783L.2 9h4.239Z"/>
                                  </svg>
                              </div>
                          </div>
                          <div class="w-full ps-3">
                              <div class="text-gray-500 text-sm mb-1.5 dark:text-gray-400">New message from <span class="font-semibold text-gray-900 dark:text-white">Jese Leos</span>: "Hey, what's up? All set for the presentation?"</div>
                              <div class="text-xs text-blue-600 dark:text-blue-500">a few moments ago</div>
                          </div>
                      </a>
                      <!-- End Example Notification -->
                  </div>
                  <a href="#" class="block py-2 text-sm font-medium text-center text-gray-900 rounded-b-lg bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white">
                      <div class="inline-flex items-center ">
                          <svg class="w-4 h-4 me-2 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 14">
                              <path d="M10 0C4.612 0 0 5.336 0 7c0 1.742 3.546 7 10 7 6.454 0 10-5.258 10-7 0-1.664-4.612-7-10-7Zm0 10a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z"/>
                          </svg>
                          View all
                      </div>
                  </a>
              </div>
          </li>
          

            <li class="nav-item dropdown pe-3">
              <a
                class="nav-link nav-profile d-flex align-items-center pe-0"
                href="#"
                data-bs-toggle="dropdown"
              >
                <img
                  src="../img/prof.png"
                  alt="Profile"
                  class="rounded-circle border"
                  style="outline: 1px solid #0a3172"
                  height="32px"
                /> </a
              ><!-- End Profile Iamge Icon -->

              <ul
                class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile"
              >
                <li class="dropdown-header">
                  <h6>Aedrian Jeao</h6>
                  <span>BatstateU CTI</span>
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>

                <li>
                  <a
                    class="dropdown-item d-flex align-items-center"
                    href="profile.html"
                  >
                    <i class="fa-regular fa-user"></i>
                    <span>My Profile</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>

                <li>
                  <a
                    class="dropdown-item d-flex align-items-center"
                    href="community.html"
                  >
                    <i class="fa-solid fa-users-rectangle"></i>
                    <span>Community</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>

                <li>
                  <a
                    class="dropdown-item d-flex align-items-center"
                    href="messages.html"
                  >
                    <i class="fa-regular fa-message"></i>
                    <span>Messages</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>

                <li>
                  <a class="dropdown-item d-flex align-items-center" href="#">
                    <i class="fa-solid fa-gear"></i>
                    <span>Account Settings</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>
                <li>
                  <a
                    class="dropdown-item d-flex align-items-center"
                    onclick="logout()"
                  >
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span>Log Out</span>
                  </a>
                </li>
              </ul>
              <!-- End Profile Dropdown Items -->
            </li>
            <!-- End Profile Nav -->
          </ul>
        </nav>
        <!-- End Icons Navigation -->
      </header>
    
    <!-- Sidebar filter -->
   <aside id="sidebar" class="bg-white shadow-lg fixed left-0 top-20 h-full w-1/5 py-8 overflow-y-auto">
        <h2 class="text-lg font-semibold mb-4 px-6">Filter</h2>
        <ul>
            <li><button id="filterAll" class="filter-button active-filter">All</button></li>
            <li><button id="filterUsers" class="filter-button">Users</button></li>
            <li><button id="filterPosts" class="filter-button">Posts</button></li>
        </ul>
    </aside>

    <!-- Main Content -->
    <div id="Results" class="ml-1/5 py-8 px-8 w-4/5">
        <!-- Search results will be displayed here -->
    </div>

    <script>
        async function fetchAndDisplaySearchResults(keyword, source) {
            try {
                const response = await fetch(`http://localhost:3000/api/v1/https/search?keyword=${keyword}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch search results');
                }
                const data = await response.json();
    
                // Optionally, you can get the current user ID if needed
                const currentUserId = sessionStorage.getItem("user_id");
    
                // Check if the source is the search result page's navbar
                if (source === "search_result_navbar") {
                    // Generate dropdown with search results
                    generateDropdown(data);
                } else {
                    // Update the result div container
                    displaySearchResults(data, currentUserId);
                }
            } catch (error) {
                console.error('Error fetching search results:', error);
            }
        }
    
        function generateDropdown(results) {
            const searchDropdown = document.getElementById('searchDropdown');
            searchDropdown.innerHTML = '';
    
            if (results && results.users && results.users.length > 0) {
                results.users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id; // Assuming user id is used as value
                    option.textContent = user.name; // Assuming user name is displayed as option text
                    searchDropdown.appendChild(option);
                });
            } else {
                const defaultOption = document.createElement('option');
                defaultOption.textContent = 'No results found';
                defaultOption.disabled = true;
                defaultOption.selected = true;
                searchDropdown.appendChild(defaultOption);
            }
        }
    


        function displaySearchResults(data, currentUserId) {
            const searchResultsContainer = document.getElementById('Results');
            searchResultsContainer.innerHTML = '';
        
            if (data.users && data.users.length > 0) {
                const userContainer = document.createElement('div');
                userContainer.classList.add('user-container');
        
                // Create and append the "Users" title above the user list
                const userTitle = document.createElement('h2');
                userTitle.textContent = 'Users';
                userTitle.classList.add('text-xl', 'font-semibold', 'mb-4');
                searchResultsContainer.appendChild(userTitle); // Append title to the search results container
        
                let displayedUsers = 0; // Track the number of displayed users with the same name
        
                data.users.forEach(async (user, index) => {
                    const userElement = document.createElement('div');
                    userElement.classList.add('result', 'user-element');
                    const userLink = document.createElement('a');
        
                    if (user.id == currentUserId) {
                        userLink.href = `http://127.0.0.1:5500/client-side-config/users/src/profile.html?userId=${user.id}`;
                    } else {
                        userLink.href = `http://127.0.0.1:5500/client-side-config/users/src/other_profile.html?userId=${user.id}`;
                    }
                    userLink.classList.add('user-link');
        
                    try {
                        const profileResponse = await fetch(`http://localhost:3000/api/v1/https/profile/${user.id}`);
                        if (profileResponse.ok) {
                            const profileData = await profileResponse.json();
                            const profilePicUrl = profileData.results[0].photo || 'user_default.jpg';
                            const profilePic = document.createElement('img');
                            profilePic.src = profilePicUrl;
                            profilePic.alt = 'Profile Picture';
                            profilePic.classList.add('profile-picture');
        
                            const userName = document.createElement('span');
                            userName.textContent = user.name;
                            userName.classList.add('user-name');
        
                            const bio = profileData.results[0].location || 'No Location available';
                            const bioParagraph = document.createElement('p');
                            bioParagraph.textContent = bio.length > 30 ? bio.substring(0, 30) + '...' : bio;
                            bioParagraph.classList.add('bio');
        
                            userLink.appendChild(profilePic);
                            userLink.appendChild(userName);
        
                            userElement.appendChild(userLink);
                            userElement.appendChild(bioParagraph); // Append bio after user link
        
                            // Add click event listener to the user element
                            if (user.id == currentUserId) {
                                const viewProfileButton = document.createElement('button');
                                viewProfileButton.textContent = 'View Profile';
                                viewProfileButton.classList.add('view-profile-button');
                                viewProfileButton.addEventListener('click', () => {
                                    window.location.href = `http://127.0.0.1:5500/client-side-config/users/src/profile.html?userId=${user.id}`;
                                });
                                userElement.appendChild(viewProfileButton);
                            } else {
                                const followButton = document.createElement('button');
                                followButton.textContent = 'Follow';
                                followButton.classList.add('follow-button');
                                followButton.addEventListener('click', () => {
                                    window.location.href = `http://127.0.0.1:5500/client-side-config/users/src/other_profile.html?userId=${user.id}`;
                                });
                                userElement.appendChild(followButton);
                            }
        
                            // Increment the displayed users count
                            displayedUsers++;
        
                            // Append the user element to the user container
                            userContainer.appendChild(userElement);
                        } else {
                            throw new Error('Failed to fetch profile picture');
                        }
                    } catch (error) {
                        console.error('Error fetching profile picture:', error);
                    }
                });
        
                // Append the user container to the search results container
                searchResultsContainer.appendChild(userContainer);

            // Add "See more" button if there are more than three users with the same name
            if (displayedUsers > 3) {
                const seeMoreButton = document.createElement('button');
                seeMoreButton.textContent = 'See more';
                seeMoreButton.classList.add('see-more-button');
                seeMoreButton.addEventListener('click', () => {
                    const hiddenUsers = userContainer.querySelectorAll('.result.user-element.hidden');
                    hiddenUsers.forEach(user => {
                        user.classList.toggle('hidden'); // Toggle the 'hidden' class
                    });
                    seeMoreButton.textContent = seeMoreButton.textContent === 'See more' ? 'See less' : 'See more';
                });
                
                searchResultsContainer.appendChild(seeMoreButton);
            } else {
                // Hide the user container if there are three or fewer users with the same name
                userContainer.classList.add('hidden');
            }


            }        
            
                
    if (data.posts && data.posts.length > 0) {
        const postContainer = document.createElement('div');
        postContainer.classList.add('post-container');
    
        const postTitle = document.createElement('h2');
        postTitle.textContent = 'Posts';
        postTitle.classList.add('text-xl', 'font-semibold', 'mb-4');
        postContainer.appendChild(postTitle);
    
        data.posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.classList.add('result', 'post-element', 'bg-white', 'rounded-md', 'p-4', 'mb-4', 'shadow-md');
    
            const postLink = document.createElement('a');
            postLink.textContent = `Post: ${post.title}`;
            postLink.href = `http://127.0.0.1:5500/client-side-config/users/src/community.html?postId=${post.id}`;
            postLink.classList.add('post-link', 'text-blue-600', 'hover:underline');
            postElement.appendChild(postLink);
    
            const likeButton = document.createElement('button');
            likeButton.textContent = 'Like';
            likeButton.classList.add('like-button', 'bg-blue-500', 'text-white', 'py-2', 'px-4', 'rounded-md', 'mr-2', 'hover:bg-blue-600');
            postElement.appendChild(likeButton);
    
            const dislikeButton = document.createElement('button');
            dislikeButton.textContent = 'Dislike';
            dislikeButton.classList.add('dislike-button', 'bg-red-500', 'text-white', 'py-2', 'px-4', 'rounded-md', 'mr-2', 'hover:bg-red-600');
            postElement.appendChild(dislikeButton);
    
            const commentButton = document.createElement('button');
            commentButton.textContent = 'Comment';
            commentButton.classList.add('comment-button', 'bg-gray-500', 'text-white', 'py-2', 'px-4', 'rounded-md', 'hover:bg-gray-600');
            postElement.appendChild(commentButton);
    
            postContainer.appendChild(postElement);
        });
    
        searchResultsContainer.appendChild(postContainer);
    }
}    
        
        /*const keyword = new URLSearchParams(window.location.search).get('keyword');
    
        
        if (keyword) {
            fetchAndDisplaySearchResults(keyword);
        } else {
            console.error('Keyword not found in URL parameters');
        }*/
        
document.addEventListener("DOMContentLoaded", function () {
        navBar();
          });
    // Event listeners for filter buttons
    document.getElementById('filterAll').addEventListener('click', function() {
        const keyword = new URLSearchParams(window.location.search).get('keyword');
        fetchAndDisplaySearchResults(keyword, 'all');
        updateFilterButtons('filterAll');
    });

    document.getElementById('filterUsers').addEventListener('click', function() {
        const keyword = new URLSearchParams(window.location.search).get('keyword');
        fetchAndDisplaySearchResults(keyword, 'users');
        updateFilterButtons('filterUsers');
    });

    document.getElementById('filterPosts').addEventListener('click', function() {
        const keyword = new URLSearchParams(window.location.search).get('keyword');
        fetchAndDisplaySearchResults(keyword, 'posts');
        updateFilterButtons('filterPosts');
    });

    // Function to update the active filter button
    function updateFilterButtons(activeButtonId) {
        const buttons = document.querySelectorAll('#sidebar button');
        buttons.forEach(button => {
            if (button.id === activeButtonId) {
                button.classList.add('active-filter');
            } else {
                button.classList.remove('active-filter');
            }
        });
    }

    // Initial fetch and display of search results with "All" filter
    window.addEventListener('load', function() {
        const keyword = new URLSearchParams(window.location.search).get('keyword');
        fetchAndDisplaySearchResults(keyword, 'all');
    });

    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');

    searchButton.addEventListener('click', function() {
        const keyword = searchInput.value.trim();
        if (keyword !== '') {
            fetchAndDisplaySearchResults(keyword, "search_result_navbar");
        } else {
            console.log('Please enter a search keyword');
        }
    });

    searchInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            const keyword = searchInput.value.trim();
            if (keyword !== '') {
                fetchAndDisplaySearchResults(keyword, "search_result_navbar");
            } else {
                console.log('Please enter a search keyword');
            }
        }
    });
    </script>
</body>
</html>
